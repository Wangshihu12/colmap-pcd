 现在我已知所有图像的位姿和lidar点云，现在我需要参考colmap-pcd项目的源码来优化图像的位姿，我需要你参考colmap-pcd项目源码中已有的函数和方法原理，帮我写一个优化图像位姿的函数流程，要求符合论文和源码：
 1、输入所有图像，图像的位姿，lidar点云
 2、从所有图像中提取2D特征，匹配特征以建立图像间对应关系，为后续三角化和优化提供基础
 3、使用近似位姿和特征对应关系，进行三角化以估计初始3D点
 4、为每个3D点找到对应的LiDAR平面，使用两种方法：深度投影法：对于能被新注册图像观测的3D点，投影到LiDAR点云，找到对应LiDAR点，选择与平面法向量角度最小的点。最近邻搜索法：使用k-d树找到与3D点欧几里得距离最近的LiDAR点，搜索半径随优化次数线性减少。确保3D点与LiDAR平面紧密关联，为优化提供距离误差
 5、设置因子图优化问题，变量包括所有相机位姿和3D点，添加两个误差项：重投影误差，3D点与lidar平面关联的距离误差，优化目标为最小化总误差，由于已知所有图像的近似位姿，可以直接进行全局捆绑调整，确保所有位姿和点的全局一致性
 6、迭代与收敛